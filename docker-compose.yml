version: '3.8'
services:
  velocity-mongo:
    image: mongo:4.0.4
    volumes:
      - ./mongo:/data
    ports:
      - 27018:27017

  credentialagent-migrations:
    image: docker.pkg.github.com/velocitynetworkfoundation/packages/credentialagent:latest
    env_file:
      - .env
    command: sh -c "cd servers/credentialagent && yarn migrate:up"
    restart: on-failure
    depends_on:
      - velocity-mongo

  credentialagent:
    image: docker.pkg.github.com/velocitynetworkfoundation/packages/credentialagent:latest
    env_file:
      - .env
    ports:
      - 8080:3000
    restart: on-failure
    depends_on:
      - credentialagent-migrations

